<?php

namespace AES;

abstract class Cipher
{


    static function generateKey($key)
    {
        $t0 = MIXCOLUMNS_INVERSE_0;
        $t1 = MIXCOLUMNS_INVERSE_1;
        $t2 = MIXCOLUMNS_INVERSE_2;
        $t3 = MIXCOLUMNS_INVERSE_3;
        $s  = SUBBYTES;

        $keyLen = strlen($key);
        $pair = [2 => $keyLen];

        switch ($keyLen) {
            case 16:
                list(,$rk0, $rk1, $rk2, $rk3) = unpack('N4', $key);

                $pair[0] = [
                    $rk0,
                    $rk1,
                    $rk2,
                    $rk3,
                    $rk4 =  $rk0 ^ ($s[ $rk3 >> 24 & 0xff] | ($s[ $rk3 & 0xff] << 8) | ($s[ $rk3 >> 8 & 0xff] << 16) | (($s[ $rk3 >> 16 & 0xff] ^ 0x01) << 24)),
                    $rk5 =  $rk1 ^ $rk4,
                    $rk6 =  $rk2 ^ $rk5,
                    $rk7 =  $rk3 ^ $rk6,
                    $rk8 =  $rk4 ^ ($s[ $rk7 >> 24 & 0xff] | ($s[ $rk7 & 0xff] << 8) | ($s[ $rk7 >> 8 & 0xff] << 16) | (($s[ $rk7 >> 16 & 0xff] ^ 0x02) << 24)),
                    $rk9 =  $rk5 ^ $rk8,
                    $rk10 =  $rk6 ^ $rk9,
                    $rk11 =  $rk7 ^ $rk10,
                    $rk12 =  $rk8 ^ ($s[$rk11 >> 24 & 0xff] | ($s[$rk11 & 0xff] << 8) | ($s[$rk11 >> 8 & 0xff] << 16) | (($s[$rk11 >> 16 & 0xff] ^ 0x04) << 24)),
                    $rk13 =  $rk9 ^ $rk12,
                    $rk14 = $rk10 ^ $rk13,
                    $rk15 = $rk11 ^ $rk14,
                    $rk16 = $rk12 ^ ($s[$rk15 >> 24 & 0xff] | ($s[$rk15 & 0xff] << 8) | ($s[$rk15 >> 8 & 0xff] << 16) | (($s[$rk15 >> 16 & 0xff] ^ 0x08) << 24)),
                    $rk17 = $rk13 ^ $rk16,
                    $rk18 = $rk14 ^ $rk17,
                    $rk19 = $rk15 ^ $rk18,
                    $rk20 = $rk16 ^ ($s[$rk19 >> 24 & 0xff] | ($s[$rk19 & 0xff] << 8) | ($s[$rk19 >> 8 & 0xff] << 16) | (($s[$rk19 >> 16 & 0xff] ^ 0x10) << 24)),
                    $rk21 = $rk17 ^ $rk20,
                    $rk22 = $rk18 ^ $rk21,
                    $rk23 = $rk19 ^ $rk22,
                    $rk24 = $rk20 ^ ($s[$rk23 >> 24 & 0xff] | ($s[$rk23 & 0xff] << 8) | ($s[$rk23 >> 8 & 0xff] << 16) | (($s[$rk23 >> 16 & 0xff] ^ 0x20) << 24)),
                    $rk25 = $rk21 ^ $rk24,
                    $rk26 = $rk22 ^ $rk25,
                    $rk27 = $rk23 ^ $rk26,
                    $rk28 = $rk24 ^ ($s[$rk27 >> 24 & 0xff] | ($s[$rk27 & 0xff] << 8) | ($s[$rk27 >> 8 & 0xff] << 16) | (($s[$rk27 >> 16 & 0xff] ^ 0x40) << 24)),
                    $rk29 = $rk25 ^ $rk28,
                    $rk30 = $rk26 ^ $rk29,
                    $rk31 = $rk27 ^ $rk30,
                    $rk32 = $rk28 ^ ($s[$rk31 >> 24 & 0xff] | ($s[$rk31 & 0xff] << 8) | ($s[$rk31 >> 8 & 0xff] << 16) | (($s[$rk31 >> 16 & 0xff] ^ 0x80) << 24)),
                    $rk33 = $rk29 ^ $rk32,
                    $rk34 = $rk30 ^ $rk33,
                    $rk35 = $rk31 ^ $rk34,
                    $rk36 = $rk32 ^ ($s[$rk35 >> 24 & 0xff] | ($s[$rk35 & 0xff] << 8) | ($s[$rk35 >> 8 & 0xff] << 16) | (($s[$rk35 >> 16 & 0xff] ^ 0x1b) << 24)),
                    $rk37 = $rk33 ^ $rk36,
                    $rk38 = $rk34 ^ $rk37,
                    $rk39 = $rk35 ^ $rk38,
                56 =>
                    $rk40 = $rk36 ^ ($s[$rk39 >> 24 & 0xff] | ($s[$rk39 & 0xff] << 8) | ($s[$rk39 >> 8 & 0xff] << 16) | (($s[$rk39 >> 16 & 0xff] ^ 0x36) << 24)),
                    $rk41 = $rk37 ^ $rk40,
                    $rk42 = $rk38 ^ $rk41,
                    $rk43 = $rk39 ^ $rk42
                ];

                $pair[1] = [
                    $rk0,
                    $rk1,
                    $rk2,
                    $rk3,
                    $t0[$s[ $rk4 >> 24 & 0xff]] ^ $t1[$s[ $rk4 >> 16 & 0xff]] ^ $t2[$s[ $rk4 >> 8 & 0xff]] ^ $t3[$s[ $rk4 & 0xff]],
                    $t0[$s[ $rk5 >> 24 & 0xff]] ^ $t1[$s[ $rk5 >> 16 & 0xff]] ^ $t2[$s[ $rk5 >> 8 & 0xff]] ^ $t3[$s[ $rk5 & 0xff]],
                    $t0[$s[ $rk6 >> 24 & 0xff]] ^ $t1[$s[ $rk6 >> 16 & 0xff]] ^ $t2[$s[ $rk6 >> 8 & 0xff]] ^ $t3[$s[ $rk6 & 0xff]],
                    $t0[$s[ $rk7 >> 24 & 0xff]] ^ $t1[$s[ $rk7 >> 16 & 0xff]] ^ $t2[$s[ $rk7 >> 8 & 0xff]] ^ $t3[$s[ $rk7 & 0xff]],
                    $t0[$s[ $rk8 >> 24 & 0xff]] ^ $t1[$s[ $rk8 >> 16 & 0xff]] ^ $t2[$s[ $rk8 >> 8 & 0xff]] ^ $t3[$s[ $rk8 & 0xff]],
                    $t0[$s[ $rk9 >> 24 & 0xff]] ^ $t1[$s[ $rk9 >> 16 & 0xff]] ^ $t2[$s[ $rk9 >> 8 & 0xff]] ^ $t3[$s[ $rk9 & 0xff]],
                    $t0[$s[$rk10 >> 24 & 0xff]] ^ $t1[$s[$rk10 >> 16 & 0xff]] ^ $t2[$s[$rk10 >> 8 & 0xff]] ^ $t3[$s[$rk10 & 0xff]],
                    $t0[$s[$rk11 >> 24 & 0xff]] ^ $t1[$s[$rk11 >> 16 & 0xff]] ^ $t2[$s[$rk11 >> 8 & 0xff]] ^ $t3[$s[$rk11 & 0xff]],
                    $t0[$s[$rk12 >> 24 & 0xff]] ^ $t1[$s[$rk12 >> 16 & 0xff]] ^ $t2[$s[$rk12 >> 8 & 0xff]] ^ $t3[$s[$rk12 & 0xff]],
                    $t0[$s[$rk13 >> 24 & 0xff]] ^ $t1[$s[$rk13 >> 16 & 0xff]] ^ $t2[$s[$rk13 >> 8 & 0xff]] ^ $t3[$s[$rk13 & 0xff]],
                    $t0[$s[$rk14 >> 24 & 0xff]] ^ $t1[$s[$rk14 >> 16 & 0xff]] ^ $t2[$s[$rk14 >> 8 & 0xff]] ^ $t3[$s[$rk14 & 0xff]],
                    $t0[$s[$rk15 >> 24 & 0xff]] ^ $t1[$s[$rk15 >> 16 & 0xff]] ^ $t2[$s[$rk15 >> 8 & 0xff]] ^ $t3[$s[$rk15 & 0xff]],
                    $t0[$s[$rk16 >> 24 & 0xff]] ^ $t1[$s[$rk16 >> 16 & 0xff]] ^ $t2[$s[$rk16 >> 8 & 0xff]] ^ $t3[$s[$rk16 & 0xff]],
                    $t0[$s[$rk17 >> 24 & 0xff]] ^ $t1[$s[$rk17 >> 16 & 0xff]] ^ $t2[$s[$rk17 >> 8 & 0xff]] ^ $t3[$s[$rk17 & 0xff]],
                    $t0[$s[$rk18 >> 24 & 0xff]] ^ $t1[$s[$rk18 >> 16 & 0xff]] ^ $t2[$s[$rk18 >> 8 & 0xff]] ^ $t3[$s[$rk18 & 0xff]],
                    $t0[$s[$rk19 >> 24 & 0xff]] ^ $t1[$s[$rk19 >> 16 & 0xff]] ^ $t2[$s[$rk19 >> 8 & 0xff]] ^ $t3[$s[$rk19 & 0xff]],
                    $t0[$s[$rk20 >> 24 & 0xff]] ^ $t1[$s[$rk20 >> 16 & 0xff]] ^ $t2[$s[$rk20 >> 8 & 0xff]] ^ $t3[$s[$rk20 & 0xff]],
                    $t0[$s[$rk21 >> 24 & 0xff]] ^ $t1[$s[$rk21 >> 16 & 0xff]] ^ $t2[$s[$rk21 >> 8 & 0xff]] ^ $t3[$s[$rk21 & 0xff]],
                    $t0[$s[$rk22 >> 24 & 0xff]] ^ $t1[$s[$rk22 >> 16 & 0xff]] ^ $t2[$s[$rk22 >> 8 & 0xff]] ^ $t3[$s[$rk22 & 0xff]],
                    $t0[$s[$rk23 >> 24 & 0xff]] ^ $t1[$s[$rk23 >> 16 & 0xff]] ^ $t2[$s[$rk23 >> 8 & 0xff]] ^ $t3[$s[$rk23 & 0xff]],
                    $t0[$s[$rk24 >> 24 & 0xff]] ^ $t1[$s[$rk24 >> 16 & 0xff]] ^ $t2[$s[$rk24 >> 8 & 0xff]] ^ $t3[$s[$rk24 & 0xff]],
                    $t0[$s[$rk25 >> 24 & 0xff]] ^ $t1[$s[$rk25 >> 16 & 0xff]] ^ $t2[$s[$rk25 >> 8 & 0xff]] ^ $t3[$s[$rk25 & 0xff]],
                    $t0[$s[$rk26 >> 24 & 0xff]] ^ $t1[$s[$rk26 >> 16 & 0xff]] ^ $t2[$s[$rk26 >> 8 & 0xff]] ^ $t3[$s[$rk26 & 0xff]],
                    $t0[$s[$rk27 >> 24 & 0xff]] ^ $t1[$s[$rk27 >> 16 & 0xff]] ^ $t2[$s[$rk27 >> 8 & 0xff]] ^ $t3[$s[$rk27 & 0xff]],
                    $t0[$s[$rk28 >> 24 & 0xff]] ^ $t1[$s[$rk28 >> 16 & 0xff]] ^ $t2[$s[$rk28 >> 8 & 0xff]] ^ $t3[$s[$rk28 & 0xff]],
                    $t0[$s[$rk29 >> 24 & 0xff]] ^ $t1[$s[$rk29 >> 16 & 0xff]] ^ $t2[$s[$rk29 >> 8 & 0xff]] ^ $t3[$s[$rk29 & 0xff]],
                    $t0[$s[$rk30 >> 24 & 0xff]] ^ $t1[$s[$rk30 >> 16 & 0xff]] ^ $t2[$s[$rk30 >> 8 & 0xff]] ^ $t3[$s[$rk30 & 0xff]],
                    $t0[$s[$rk31 >> 24 & 0xff]] ^ $t1[$s[$rk31 >> 16 & 0xff]] ^ $t2[$s[$rk31 >> 8 & 0xff]] ^ $t3[$s[$rk31 & 0xff]],
                    $t0[$s[$rk32 >> 24 & 0xff]] ^ $t1[$s[$rk32 >> 16 & 0xff]] ^ $t2[$s[$rk32 >> 8 & 0xff]] ^ $t3[$s[$rk32 & 0xff]],
                    $t0[$s[$rk33 >> 24 & 0xff]] ^ $t1[$s[$rk33 >> 16 & 0xff]] ^ $t2[$s[$rk33 >> 8 & 0xff]] ^ $t3[$s[$rk33 & 0xff]],
                    $t0[$s[$rk34 >> 24 & 0xff]] ^ $t1[$s[$rk34 >> 16 & 0xff]] ^ $t2[$s[$rk34 >> 8 & 0xff]] ^ $t3[$s[$rk34 & 0xff]],
                    $t0[$s[$rk35 >> 24 & 0xff]] ^ $t1[$s[$rk35 >> 16 & 0xff]] ^ $t2[$s[$rk35 >> 8 & 0xff]] ^ $t3[$s[$rk35 & 0xff]],
                    $t0[$s[$rk36 >> 24 & 0xff]] ^ $t1[$s[$rk36 >> 16 & 0xff]] ^ $t2[$s[$rk36 >> 8 & 0xff]] ^ $t3[$s[$rk36 & 0xff]],
                    $t0[$s[$rk37 >> 24 & 0xff]] ^ $t1[$s[$rk37 >> 16 & 0xff]] ^ $t2[$s[$rk37 >> 8 & 0xff]] ^ $t3[$s[$rk37 & 0xff]],
                    $t0[$s[$rk38 >> 24 & 0xff]] ^ $t1[$s[$rk38 >> 16 & 0xff]] ^ $t2[$s[$rk38 >> 8 & 0xff]] ^ $t3[$s[$rk38 & 0xff]],
                    $t0[$s[$rk39 >> 24 & 0xff]] ^ $t1[$s[$rk39 >> 16 & 0xff]] ^ $t2[$s[$rk39 >> 8 & 0xff]] ^ $t3[$s[$rk39 & 0xff]],
                56 =>
                    $rk40,
                    $rk41,
                    $rk42,
                    $rk43,
                ];
                break;
            case 24:
                list(,$rk0, $rk1, $rk2, $rk3, $rk4, $rk5) = unpack('N6', $key);

                $pair[0] = [
                    $rk0,
                    $rk1,
                    $rk2,
                    $rk3,
                    $rk4,
                    $rk5,
                    $rk6 =  $rk0 ^ ($s[ $rk5 >> 24 & 0xff] | ($s[ $rk5 & 0xff] << 8) | ($s[ $rk5 >> 8 & 0xff] << 16) | (($s[ $rk5 >> 16 & 0xff] ^ 0x01) << 24)),
                    $rk7 =  $rk1 ^  $rk6,
                    $rk8 =  $rk2 ^  $rk7,
                    $rk9 =  $rk3 ^  $rk8,
                    $rk10 =  $rk4 ^  $rk9,
                    $rk11 =  $rk5 ^ $rk10,
                    $rk12 =  $rk6 ^ ($s[$rk11 >> 24 & 0xff] | ($s[$rk11 & 0xff] << 8) | ($s[$rk11 >> 8 & 0xff] << 16) | (($s[$rk11 >> 16 & 0xff] ^ 0x02) << 24)),
                    $rk13 =  $rk7 ^ $rk12,
                    $rk14 =  $rk8 ^ $rk13,
                    $rk15 =  $rk9 ^ $rk14,
                    $rk16 = $rk10 ^ $rk15,
                    $rk17 = $rk11 ^ $rk16,
                    $rk18 = $rk12 ^ ($s[$rk17 >> 24 & 0xff] | ($s[$rk17 & 0xff] << 8) | ($s[$rk17 >> 8 & 0xff] << 16) | (($s[$rk17 >> 16 & 0xff] ^ 0x04) << 24)),
                    $rk19 = $rk13 ^ $rk18,
                    $rk20 = $rk14 ^ $rk19,
                    $rk21 = $rk15 ^ $rk20,
                    $rk22 = $rk16 ^ $rk21,
                    $rk23 = $rk17 ^ $rk22,
                    $rk24 = $rk18 ^ ($s[$rk23 >> 24 & 0xff] | ($s[$rk23 & 0xff] << 8) | ($s[$rk23 >> 8 & 0xff] << 16) | (($s[$rk23 >> 16 & 0xff] ^ 0x08) << 24)),
                    $rk25 = $rk19 ^ $rk24,
                    $rk26 = $rk20 ^ $rk25,
                    $rk27 = $rk21 ^ $rk26,
                    $rk28 = $rk22 ^ $rk27,
                    $rk29 = $rk23 ^ $rk28,
                    $rk30 = $rk24 ^ ($s[$rk29 >> 24 & 0xff] | ($s[$rk29 & 0xff] << 8) | ($s[$rk29 >> 8 & 0xff] << 16) | (($s[$rk29 >> 16 & 0xff] ^ 0x10) << 24)),
                    $rk31 = $rk25 ^ $rk30,
                    $rk32 = $rk26 ^ $rk31,
                    $rk33 = $rk27 ^ $rk32,
                    $rk34 = $rk28 ^ $rk33,
                    $rk35 = $rk29 ^ $rk34,
                    $rk36 = $rk30 ^ ($s[$rk35 >> 24 & 0xff] | ($s[$rk35 & 0xff] << 8) | ($s[$rk35 >> 8 & 0xff] << 16) | (($s[$rk35 >> 16 & 0xff] ^ 0x20) << 24)),
                    $rk37 = $rk31 ^ $rk36,
                    $rk38 = $rk32 ^ $rk37,
                    $rk39 = $rk33 ^ $rk38,
                    $rk40 = $rk34 ^ $rk39,
                    $rk41 = $rk35 ^ $rk40,
                    $rk42 = $rk36 ^ ($s[$rk41 >> 24 & 0xff] | ($s[$rk41 & 0xff] << 8) | ($s[$rk41 >> 8 & 0xff] << 16) | (($s[$rk41 >> 16 & 0xff] ^ 0x40) << 24)),
                    $rk43 = $rk37 ^ $rk42,
                    $rk44 = $rk38 ^ $rk43,
                    $rk45 = $rk39 ^ $rk44,
                    $rk46 = $rk40 ^ $rk45,
                    $rk47 = $rk41 ^ $rk46,
                56 =>
                    $rk48 = $rk42 ^ ($s[$rk47 >> 24 & 0xff] | ($s[$rk47 & 0xff] << 8) | ($s[$rk47 >> 8 & 0xff] << 16) | (($s[$rk47 >> 16 & 0xff] ^ 0x80) << 24)),
                    $rk49 = $rk43 ^ $rk48,
                    $rk50 = $rk44 ^ $rk49,
                    $rk51 = $rk45 ^ $rk50
                ];

                $pair[1] = [
                    $rk0,
                    $rk1,
                    $rk2,
                    $rk3,
                    $t0[$s[ $rk4 >> 24 & 0xff]] ^ $t1[$s[ $rk4 >> 16 & 0xff]] ^ $t2[$s[ $rk4 >> 8 & 0xff]] ^ $t3[$s[ $rk4 & 0xff]],
                    $t0[$s[ $rk5 >> 24 & 0xff]] ^ $t1[$s[ $rk5 >> 16 & 0xff]] ^ $t2[$s [$rk5 >> 8 & 0xff]] ^ $t3[$s[ $rk5 & 0xff]],
                    $t0[$s[ $rk6 >> 24 & 0xff]] ^ $t1[$s[ $rk6 >> 16 & 0xff]] ^ $t2[$s[ $rk6 >> 8 & 0xff]] ^ $t3[$s[ $rk6 & 0xff]],
                    $t0[$s[ $rk7 >> 24 & 0xff]] ^ $t1[$s[ $rk7 >> 16 & 0xff]] ^ $t2[$s[ $rk7 >> 8 & 0xff]] ^ $t3[$s[ $rk7 & 0xff]],
                    $t0[$s[ $rk8 >> 24 & 0xff]] ^ $t1[$s[ $rk8 >> 16 & 0xff]] ^ $t2[$s[ $rk8 >> 8 & 0xff]] ^ $t3[$s[ $rk8 & 0xff]],
                    $t0[$s[ $rk9 >> 24 & 0xff]] ^ $t1[$s[ $rk9 >> 16 & 0xff]] ^ $t2[$s[ $rk9 >> 8 & 0xff]] ^ $t3[$s[ $rk9 & 0xff]],
                    $t0[$s[$rk10 >> 24 & 0xff]] ^ $t1[$s[$rk10 >> 16 & 0xff]] ^ $t2[$s[$rk10 >> 8 & 0xff]] ^ $t3[$s[$rk10 & 0xff]],
                    $t0[$s[$rk11 >> 24 & 0xff]] ^ $t1[$s[$rk11 >> 16 & 0xff]] ^ $t2[$s[$rk11 >> 8 & 0xff]] ^ $t3[$s[$rk11 & 0xff]],
                    $t0[$s[$rk12 >> 24 & 0xff]] ^ $t1[$s[$rk12 >> 16 & 0xff]] ^ $t2[$s[$rk12 >> 8 & 0xff]] ^ $t3[$s[$rk12 & 0xff]],
                    $t0[$s[$rk13 >> 24 & 0xff]] ^ $t1[$s[$rk13 >> 16 & 0xff]] ^ $t2[$s[$rk13 >> 8 & 0xff]] ^ $t3[$s[$rk13 & 0xff]],
                    $t0[$s[$rk14 >> 24 & 0xff]] ^ $t1[$s[$rk14 >> 16 & 0xff]] ^ $t2[$s[$rk14 >> 8 & 0xff]] ^ $t3[$s[$rk14 & 0xff]],
                    $t0[$s[$rk15 >> 24 & 0xff]] ^ $t1[$s[$rk15 >> 16 & 0xff]] ^ $t2[$s[$rk15 >> 8 & 0xff]] ^ $t3[$s[$rk15 & 0xff]],
                    $t0[$s[$rk16 >> 24 & 0xff]] ^ $t1[$s[$rk16 >> 16 & 0xff]] ^ $t2[$s[$rk16 >> 8 & 0xff]] ^ $t3[$s[$rk16 & 0xff]],
                    $t0[$s[$rk17 >> 24 & 0xff]] ^ $t1[$s[$rk17 >> 16 & 0xff]] ^ $t2[$s[$rk17 >> 8 & 0xff]] ^ $t3[$s[$rk17 & 0xff]],
                    $t0[$s[$rk18 >> 24 & 0xff]] ^ $t1[$s[$rk18 >> 16 & 0xff]] ^ $t2[$s[$rk18 >> 8 & 0xff]] ^ $t3[$s[$rk18 & 0xff]],
                    $t0[$s[$rk19 >> 24 & 0xff]] ^ $t1[$s[$rk19 >> 16 & 0xff]] ^ $t2[$s[$rk19 >> 8 & 0xff]] ^ $t3[$s[$rk19 & 0xff]],
                    $t0[$s[$rk20 >> 24 & 0xff]] ^ $t1[$s[$rk20 >> 16 & 0xff]] ^ $t2[$s[$rk20 >> 8 & 0xff]] ^ $t3[$s[$rk20 & 0xff]],
                    $t0[$s[$rk21 >> 24 & 0xff]] ^ $t1[$s[$rk21 >> 16 & 0xff]] ^ $t2[$s[$rk21 >> 8 & 0xff]] ^ $t3[$s[$rk21 & 0xff]],
                    $t0[$s[$rk22 >> 24 & 0xff]] ^ $t1[$s[$rk22 >> 16 & 0xff]] ^ $t2[$s[$rk22 >> 8 & 0xff]] ^ $t3[$s[$rk22 & 0xff]],
                    $t0[$s[$rk23 >> 24 & 0xff]] ^ $t1[$s[$rk23 >> 16 & 0xff]] ^ $t2[$s[$rk23 >> 8 & 0xff]] ^ $t3[$s[$rk23 & 0xff]],
                    $t0[$s[$rk24 >> 24 & 0xff]] ^ $t1[$s[$rk24 >> 16 & 0xff]] ^ $t2[$s[$rk24 >> 8 & 0xff]] ^ $t3[$s[$rk24 & 0xff]],
                    $t0[$s[$rk25 >> 24 & 0xff]] ^ $t1[$s[$rk25 >> 16 & 0xff]] ^ $t2[$s[$rk25 >> 8 & 0xff]] ^ $t3[$s[$rk25 & 0xff]],
                    $t0[$s[$rk26 >> 24 & 0xff]] ^ $t1[$s[$rk26 >> 16 & 0xff]] ^ $t2[$s[$rk26 >> 8 & 0xff]] ^ $t3[$s[$rk26 & 0xff]],
                    $t0[$s[$rk27 >> 24 & 0xff]] ^ $t1[$s[$rk27 >> 16 & 0xff]] ^ $t2[$s[$rk27 >> 8 & 0xff]] ^ $t3[$s[$rk27 & 0xff]],
                    $t0[$s[$rk28 >> 24 & 0xff]] ^ $t1[$s[$rk28 >> 16 & 0xff]] ^ $t2[$s[$rk28 >> 8 & 0xff]] ^ $t3[$s[$rk28 & 0xff]],
                    $t0[$s[$rk29 >> 24 & 0xff]] ^ $t1[$s[$rk29 >> 16 & 0xff]] ^ $t2[$s[$rk29 >> 8 & 0xff]] ^ $t3[$s[$rk29 & 0xff]],
                    $t0[$s[$rk30 >> 24 & 0xff]] ^ $t1[$s[$rk30 >> 16 & 0xff]] ^ $t2[$s[$rk30 >> 8 & 0xff]] ^ $t3[$s[$rk30 & 0xff]],
                    $t0[$s[$rk31 >> 24 & 0xff]] ^ $t1[$s[$rk31 >> 16 & 0xff]] ^ $t2[$s[$rk31 >> 8 & 0xff]] ^ $t3[$s[$rk31 & 0xff]],
                    $t0[$s[$rk32 >> 24 & 0xff]] ^ $t1[$s[$rk32 >> 16 & 0xff]] ^ $t2[$s[$rk32 >> 8 & 0xff]] ^ $t3[$s[$rk32 & 0xff]],
                    $t0[$s[$rk33 >> 24 & 0xff]] ^ $t1[$s[$rk33 >> 16 & 0xff]] ^ $t2[$s[$rk33 >> 8 & 0xff]] ^ $t3[$s[$rk33 & 0xff]],
                    $t0[$s[$rk34 >> 24 & 0xff]] ^ $t1[$s[$rk34 >> 16 & 0xff]] ^ $t2[$s[$rk34 >> 8 & 0xff]] ^ $t3[$s[$rk34 & 0xff]],
                    $t0[$s[$rk35 >> 24 & 0xff]] ^ $t1[$s[$rk35 >> 16 & 0xff]] ^ $t2[$s[$rk35 >> 8 & 0xff]] ^ $t3[$s[$rk35 & 0xff]],
                    $t0[$s[$rk36 >> 24 & 0xff]] ^ $t1[$s[$rk36 >> 16 & 0xff]] ^ $t2[$s[$rk36 >> 8 & 0xff]] ^ $t3[$s[$rk36 & 0xff]],
                    $t0[$s[$rk37 >> 24 & 0xff]] ^ $t1[$s[$rk37 >> 16 & 0xff]] ^ $t2[$s[$rk37 >> 8 & 0xff]] ^ $t3[$s[$rk37 & 0xff]],
                    $t0[$s[$rk38 >> 24 & 0xff]] ^ $t1[$s[$rk38 >> 16 & 0xff]] ^ $t2[$s[$rk38 >> 8 & 0xff]] ^ $t3[$s[$rk38 & 0xff]],
                    $t0[$s[$rk39 >> 24 & 0xff]] ^ $t1[$s[$rk39 >> 16 & 0xff]] ^ $t2[$s[$rk39 >> 8 & 0xff]] ^ $t3[$s[$rk39 & 0xff]],
                    $t0[$s[$rk40 >> 24 & 0xff]] ^ $t1[$s[$rk40 >> 16 & 0xff]] ^ $t2[$s[$rk40 >> 8 & 0xff]] ^ $t3[$s[$rk40 & 0xff]],
                    $t0[$s[$rk41 >> 24 & 0xff]] ^ $t1[$s[$rk41 >> 16 & 0xff]] ^ $t2[$s[$rk41 >> 8 & 0xff]] ^ $t3[$s[$rk41 & 0xff]],
                    $t0[$s[$rk42 >> 24 & 0xff]] ^ $t1[$s[$rk42 >> 16 & 0xff]] ^ $t2[$s[$rk42 >> 8 & 0xff]] ^ $t3[$s[$rk42 & 0xff]],
                    $t0[$s[$rk43 >> 24 & 0xff]] ^ $t1[$s[$rk43 >> 16 & 0xff]] ^ $t2[$s[$rk43 >> 8 & 0xff]] ^ $t3[$s[$rk43 & 0xff]],
                    $t0[$s[$rk44 >> 24 & 0xff]] ^ $t1[$s[$rk44 >> 16 & 0xff]] ^ $t2[$s[$rk44 >> 8 & 0xff]] ^ $t3[$s[$rk44 & 0xff]],
                    $t0[$s[$rk45 >> 24 & 0xff]] ^ $t1[$s[$rk45 >> 16 & 0xff]] ^ $t2[$s[$rk45 >> 8 & 0xff]] ^ $t3[$s[$rk45 & 0xff]],
                    $t0[$s[$rk46 >> 24 & 0xff]] ^ $t1[$s[$rk46 >> 16 & 0xff]] ^ $t2[$s[$rk46 >> 8 & 0xff]] ^ $t3[$s[$rk46 & 0xff]],
                    $t0[$s[$rk47 >> 24 & 0xff]] ^ $t1[$s[$rk47 >> 16 & 0xff]] ^ $t2[$s[$rk47 >> 8 & 0xff]] ^ $t3[$s[$rk47 & 0xff]],
                56 =>
                    $rk48,
                    $rk49,
                    $rk50,
                    $rk51
                ];

                break;
            case 32:
                list(,$rk0, $rk1, $rk2, $rk3, $rk4, $rk5, $rk6, $rk7) = unpack('N8', $key);

                $pair[0] = [
                    $rk0,
                    $rk1,
                    $rk2,
                    $rk3,
                    $rk4,
                    $rk5,
                    $rk6,
                    $rk7,
                    $rk8 =  $rk0 ^  ($s[ $rk7 >> 24 & 0xff] | ($s[ $rk7 & 0xff] << 8) | ($s[ $rk7 >> 8 & 0xff] << 16) | (($s[ $rk7 >> 16 & 0xff] ^ 0x01) << 24)),
                    $rk9 =  $rk1 ^  $rk8,
                    $rk10 =  $rk2 ^  $rk9,
                    $rk11 =  $rk3 ^ $rk10,
                    $rk12 =  $rk4 ^ ($s[$rk11 & 0xff] | ($s[$rk11 >> 8 & 0xff] << 8) | ($s[$rk11 >> 16 & 0xff] << 16) | ($s[$rk11 >> 24 & 0xff] << 24)),
                    $rk13 =  $rk5 ^ $rk12,
                    $rk14 =  $rk6 ^ $rk13,
                    $rk15 =  $rk7 ^ $rk14,
                    $rk16 =  $rk8 ^ ($s[$rk15 >> 24 & 0xff] | ($s[$rk15 & 0xff] << 8) | ($s[$rk15 >> 8 & 0xff] << 16) | (($s[$rk15 >> 16 & 0xff] ^ 0x02) << 24)),
                    $rk17 =  $rk9 ^ $rk16,
                    $rk18 = $rk10 ^ $rk17,
                    $rk19 = $rk11 ^ $rk18,
                    $rk20 = $rk12 ^ ($s[$rk19 & 0xff] | ($s[$rk19 >> 8 & 0xff] << 8) | ($s[$rk19 >> 16 & 0xff] << 16) | ($s[$rk19 >> 24 & 0xff] << 24)),
                    $rk21 = $rk13 ^ $rk20,
                    $rk22 = $rk14 ^ $rk21,
                    $rk23 = $rk15 ^ $rk22,
                    $rk24 = $rk16 ^ ($s[$rk23 >> 24 & 0xff] | ($s[$rk23 & 0xff] << 8) | ($s[$rk23 >> 8 & 0xff] << 16) | (($s[$rk23 >> 16 & 0xff] ^ 0x04) << 24)),
                    $rk25 = $rk17 ^ $rk24,
                    $rk26 = $rk18 ^ $rk25,
                    $rk27 = $rk19 ^ $rk26,
                    $rk28 = $rk20 ^ ($s[$rk27 & 0xff] | ($s[$rk27 >> 8 & 0xff] << 8) | ($s[$rk27 >> 16 & 0xff] << 16) | ($s[$rk27 >> 24 & 0xff] << 24)),
                    $rk29 = $rk21 ^ $rk28,
                    $rk30 = $rk22 ^ $rk29,
                    $rk31 = $rk23 ^ $rk30,
                    $rk32 = $rk24 ^ ($s[$rk31 >> 24 & 0xff] | ($s[$rk31 & 0xff] << 8) | ($s[$rk31 >> 8 & 0xff] << 16) | (($s[$rk31 >> 16 & 0xff] ^ 0x08) << 24)),
                    $rk33 = $rk25 ^ $rk32,
                    $rk34 = $rk26 ^ $rk33,
                    $rk35 = $rk27 ^ $rk34,
                    $rk36 = $rk28 ^ ($s[$rk35 & 0xff] | ($s[$rk35 >> 8 & 0xff] << 8) | ($s[$rk35 >> 16 & 0xff] << 16) | ($s[$rk35 >> 24 & 0xff] << 24)),
                    $rk37 = $rk29 ^ $rk36,
                    $rk38 = $rk30 ^ $rk37,
                    $rk39 = $rk31 ^ $rk38,
                    $rk40 = $rk32 ^ ($s[$rk39 >> 24 & 0xff] | ($s[$rk39 & 0xff] << 8) | ($s[$rk39 >> 8 & 0xff] << 16) | (($s[$rk39 >> 16 & 0xff] ^ 0x10) << 24)),
                    $rk41 = $rk33 ^ $rk40,
                    $rk42 = $rk34 ^ $rk41,
                    $rk43 = $rk35 ^ $rk42,
                    $rk44 = $rk36 ^ ($s[$rk43 & 0xff] | ($s[$rk43 >> 8 & 0xff] << 8) | ($s[$rk43 >> 16 & 0xff] << 16) | ($s[$rk43 >> 24 & 0xff] << 24)),
                    $rk45 = $rk37 ^ $rk44,
                    $rk46 = $rk38 ^ $rk45,
                    $rk47 = $rk39 ^ $rk46,
                    $rk48 = $rk40 ^ ($s[$rk47 >> 24 & 0xff] | ($s[$rk47 & 0xff] << 8) | ($s[$rk47 >> 8 & 0xff] << 16) | (($s[$rk47 >> 16 & 0xff] ^ 0x20) << 24)),
                    $rk49 = $rk41 ^ $rk48,
                    $rk50 = $rk42 ^ $rk49,
                    $rk51 = $rk43 ^ $rk50,
                    $rk52 = $rk44 ^ ($s[$rk51 & 0xff] | ($s[$rk51 >> 8 & 0xff] << 8) | ($s[$rk51 >> 16 & 0xff] << 16) | ($s[$rk51 >> 24 & 0xff] << 24)),
                    $rk53 = $rk45 ^ $rk52,
                    $rk54 = $rk46 ^ $rk53,
                    $rk55 = $rk47 ^ $rk54,
                    $rk56 = $rk48 ^ ($s[$rk55 >> 24 & 0xff] | ($s[$rk55 & 0xff] << 8) | ($s[$rk55 >> 8 & 0xff] << 16) | (($s[$rk55 >> 16 & 0xff] ^ 0x40) << 24)),
                    $rk57 = $rk49 ^ $rk56,
                    $rk58 = $rk50 ^ $rk57,
                    $rk59 = $rk51 ^ $rk58
                ];

                $pair[1] = [
                    $rk0,
                    $rk1,
                    $rk2,
                    $rk3,
                    $t0[$s[ $rk4 >> 24 & 0xff]] ^ $t1[$s[ $rk4 >> 16 & 0xff]] ^ $t2[$s[ $rk4 >> 8 & 0xff]] ^ $t3[$s[ $rk4 & 0xff]],
                    $t0[$s[ $rk5 >> 24 & 0xff]] ^ $t1[$s[ $rk5 >> 16 & 0xff]] ^ $t2[$s[ $rk5 >> 8 & 0xff]] ^ $t3[$s[ $rk5 & 0xff]],
                    $t0[$s[ $rk6 >> 24 & 0xff]] ^ $t1[$s[ $rk6 >> 16 & 0xff]] ^ $t2[$s[ $rk6 >> 8 & 0xff]] ^ $t3[$s[ $rk6 & 0xff]],
                    $t0[$s[ $rk7 >> 24 & 0xff]] ^ $t1[$s[ $rk7 >> 16 & 0xff]] ^ $t2[$s[ $rk7 >> 8 & 0xff]] ^ $t3[$s[ $rk7 & 0xff]],
                    $t0[$s[ $rk8 >> 24 & 0xff]] ^ $t1[$s[ $rk8 >> 16 & 0xff]] ^ $t2[$s[ $rk8 >> 8 & 0xff]] ^ $t3[$s[ $rk8 & 0xff]],
                    $t0[$s[ $rk9 >> 24 & 0xff]] ^ $t1[$s[ $rk9 >> 16 & 0xff]] ^ $t2[$s[ $rk9 >> 8 & 0xff]] ^ $t3[$s[ $rk9 & 0xff]],
                    $t0[$s[$rk10 >> 24 & 0xff]] ^ $t1[$s[$rk10 >> 16 & 0xff]] ^ $t2[$s[$rk10 >> 8 & 0xff]] ^ $t3[$s[$rk10 & 0xff]],
                    $t0[$s[$rk11 >> 24 & 0xff]] ^ $t1[$s[$rk11 >> 16 & 0xff]] ^ $t2[$s[$rk11 >> 8 & 0xff]] ^ $t3[$s[$rk11 & 0xff]],
                    $t0[$s[$rk12 >> 24 & 0xff]] ^ $t1[$s[$rk12 >> 16 & 0xff]] ^ $t2[$s[$rk12 >> 8 & 0xff]] ^ $t3[$s[$rk12 & 0xff]],
                    $t0[$s[$rk13 >> 24 & 0xff]] ^ $t1[$s[$rk13 >> 16 & 0xff]] ^ $t2[$s[$rk13 >> 8 & 0xff]] ^ $t3[$s[$rk13 & 0xff]],
                    $t0[$s[$rk14 >> 24 & 0xff]] ^ $t1[$s[$rk14 >> 16 & 0xff]] ^ $t2[$s[$rk14 >> 8 & 0xff]] ^ $t3[$s[$rk14 & 0xff]],
                    $t0[$s[$rk15 >> 24 & 0xff]] ^ $t1[$s[$rk15 >> 16 & 0xff]] ^ $t2[$s[$rk15 >> 8 & 0xff]] ^ $t3[$s[$rk15 & 0xff]],
                    $t0[$s[$rk16 >> 24 & 0xff]] ^ $t1[$s[$rk16 >> 16 & 0xff]] ^ $t2[$s[$rk16 >> 8 & 0xff]] ^ $t3[$s[$rk16 & 0xff]],
                    $t0[$s[$rk17 >> 24 & 0xff]] ^ $t1[$s[$rk17 >> 16 & 0xff]] ^ $t2[$s[$rk17 >> 8 & 0xff]] ^ $t3[$s[$rk17 & 0xff]],
                    $t0[$s[$rk18 >> 24 & 0xff]] ^ $t1[$s[$rk18 >> 16 & 0xff]] ^ $t2[$s[$rk18 >> 8 & 0xff]] ^ $t3[$s[$rk18 & 0xff]],
                    $t0[$s[$rk19 >> 24 & 0xff]] ^ $t1[$s[$rk19 >> 16 & 0xff]] ^ $t2[$s[$rk19 >> 8 & 0xff]] ^ $t3[$s[$rk19 & 0xff]],
                    $t0[$s[$rk20 >> 24 & 0xff]] ^ $t1[$s[$rk20 >> 16 & 0xff]] ^ $t2[$s[$rk20 >> 8 & 0xff]] ^ $t3[$s[$rk20 & 0xff]],
                    $t0[$s[$rk21 >> 24 & 0xff]] ^ $t1[$s[$rk21 >> 16 & 0xff]] ^ $t2[$s[$rk21 >> 8 & 0xff]] ^ $t3[$s[$rk21 & 0xff]],
                    $t0[$s[$rk22 >> 24 & 0xff]] ^ $t1[$s[$rk22 >> 16 & 0xff]] ^ $t2[$s[$rk22 >> 8 & 0xff]] ^ $t3[$s[$rk22 & 0xff]],
                    $t0[$s[$rk23 >> 24 & 0xff]] ^ $t1[$s[$rk23 >> 16 & 0xff]] ^ $t2[$s[$rk23 >> 8 & 0xff]] ^ $t3[$s[$rk23 & 0xff]],
                    $t0[$s[$rk24 >> 24 & 0xff]] ^ $t1[$s[$rk24 >> 16 & 0xff]] ^ $t2[$s[$rk24 >> 8 & 0xff]] ^ $t3[$s[$rk24 & 0xff]],
                    $t0[$s[$rk25 >> 24 & 0xff]] ^ $t1[$s[$rk25 >> 16 & 0xff]] ^ $t2[$s[$rk25 >> 8 & 0xff]] ^ $t3[$s[$rk25 & 0xff]],
                    $t0[$s[$rk26 >> 24 & 0xff]] ^ $t1[$s[$rk26 >> 16 & 0xff]] ^ $t2[$s[$rk26 >> 8 & 0xff]] ^ $t3[$s[$rk26 & 0xff]],
                    $t0[$s[$rk27 >> 24 & 0xff]] ^ $t1[$s[$rk27 >> 16 & 0xff]] ^ $t2[$s[$rk27 >> 8 & 0xff]] ^ $t3[$s[$rk27 & 0xff]],
                    $t0[$s[$rk28 >> 24 & 0xff]] ^ $t1[$s[$rk28 >> 16 & 0xff]] ^ $t2[$s[$rk28 >> 8 & 0xff]] ^ $t3[$s[$rk28 & 0xff]],
                    $t0[$s[$rk29 >> 24 & 0xff]] ^ $t1[$s[$rk29 >> 16 & 0xff]] ^ $t2[$s[$rk29 >> 8 & 0xff]] ^ $t3[$s[$rk29 & 0xff]],
                    $t0[$s[$rk30 >> 24 & 0xff]] ^ $t1[$s[$rk30 >> 16 & 0xff]] ^ $t2[$s[$rk30 >> 8 & 0xff]] ^ $t3[$s[$rk30 & 0xff]],
                    $t0[$s[$rk31 >> 24 & 0xff]] ^ $t1[$s[$rk31 >> 16 & 0xff]] ^ $t2[$s[$rk31 >> 8 & 0xff]] ^ $t3[$s[$rk31 & 0xff]],
                    $t0[$s[$rk32 >> 24 & 0xff]] ^ $t1[$s[$rk32 >> 16 & 0xff]] ^ $t2[$s[$rk32 >> 8 & 0xff]] ^ $t3[$s[$rk32 & 0xff]],
                    $t0[$s[$rk33 >> 24 & 0xff]] ^ $t1[$s[$rk33 >> 16 & 0xff]] ^ $t2[$s[$rk33 >> 8 & 0xff]] ^ $t3[$s[$rk33 & 0xff]],
                    $t0[$s[$rk34 >> 24 & 0xff]] ^ $t1[$s[$rk34 >> 16 & 0xff]] ^ $t2[$s[$rk34 >> 8 & 0xff]] ^ $t3[$s[$rk34 & 0xff]],
                    $t0[$s[$rk35 >> 24 & 0xff]] ^ $t1[$s[$rk35 >> 16 & 0xff]] ^ $t2[$s[$rk35 >> 8 & 0xff]] ^ $t3[$s[$rk35 & 0xff]],
                    $t0[$s[$rk36 >> 24 & 0xff]] ^ $t1[$s[$rk36 >> 16 & 0xff]] ^ $t2[$s[$rk36 >> 8 & 0xff]] ^ $t3[$s[$rk36 & 0xff]],
                    $t0[$s[$rk37 >> 24 & 0xff]] ^ $t1[$s[$rk37 >> 16 & 0xff]] ^ $t2[$s[$rk37 >> 8 & 0xff]] ^ $t3[$s[$rk37 & 0xff]],
                    $t0[$s[$rk38 >> 24 & 0xff]] ^ $t1[$s[$rk38 >> 16 & 0xff]] ^ $t2[$s[$rk38 >> 8 & 0xff]] ^ $t3[$s[$rk38 & 0xff]],
                    $t0[$s[$rk39 >> 24 & 0xff]] ^ $t1[$s[$rk39 >> 16 & 0xff]] ^ $t2[$s[$rk39 >> 8 & 0xff]] ^ $t3[$s[$rk39 & 0xff]],
                    $t0[$s[$rk40 >> 24 & 0xff]] ^ $t1[$s[$rk40 >> 16 & 0xff]] ^ $t2[$s[$rk40 >> 8 & 0xff]] ^ $t3[$s[$rk40 & 0xff]],
                    $t0[$s[$rk41 >> 24 & 0xff]] ^ $t1[$s[$rk41 >> 16 & 0xff]] ^ $t2[$s[$rk41 >> 8 & 0xff]] ^ $t3[$s[$rk41 & 0xff]],
                    $t0[$s[$rk42 >> 24 & 0xff]] ^ $t1[$s[$rk42 >> 16 & 0xff]] ^ $t2[$s[$rk42 >> 8 & 0xff]] ^ $t3[$s[$rk42 & 0xff]],
                    $t0[$s[$rk43 >> 24 & 0xff]] ^ $t1[$s[$rk43 >> 16 & 0xff]] ^ $t2[$s[$rk43 >> 8 & 0xff]] ^ $t3[$s[$rk43 & 0xff]],
                    $t0[$s[$rk44 >> 24 & 0xff]] ^ $t1[$s[$rk44 >> 16 & 0xff]] ^ $t2[$s[$rk44 >> 8 & 0xff]] ^ $t3[$s[$rk44 & 0xff]],
                    $t0[$s[$rk45 >> 24 & 0xff]] ^ $t1[$s[$rk45 >> 16 & 0xff]] ^ $t2[$s[$rk45 >> 8 & 0xff]] ^ $t3[$s[$rk45 & 0xff]],
                    $t0[$s[$rk46 >> 24 & 0xff]] ^ $t1[$s[$rk46 >> 16 & 0xff]] ^ $t2[$s[$rk46 >> 8 & 0xff]] ^ $t3[$s[$rk46 & 0xff]],
                    $t0[$s[$rk47 >> 24 & 0xff]] ^ $t1[$s[$rk47 >> 16 & 0xff]] ^ $t2[$s[$rk47 >> 8 & 0xff]] ^ $t3[$s[$rk47 & 0xff]],
                    $t0[$s[$rk48 >> 24 & 0xff]] ^ $t1[$s[$rk48 >> 16 & 0xff]] ^ $t2[$s[$rk48 >> 8 & 0xff]] ^ $t3[$s[$rk48 & 0xff]],
                    $t0[$s[$rk49 >> 24 & 0xff]] ^ $t1[$s[$rk49 >> 16 & 0xff]] ^ $t2[$s[$rk49 >> 8 & 0xff]] ^ $t3[$s[$rk49 & 0xff]],
                    $t0[$s[$rk50 >> 24 & 0xff]] ^ $t1[$s[$rk50 >> 16 & 0xff]] ^ $t2[$s[$rk50 >> 8 & 0xff]] ^ $t3[$s[$rk50 & 0xff]],
                    $t0[$s[$rk51 >> 24 & 0xff]] ^ $t1[$s[$rk51 >> 16 & 0xff]] ^ $t2[$s[$rk51 >> 8 & 0xff]] ^ $t3[$s[$rk51 & 0xff]],
                    $t0[$s[$rk52 >> 24 & 0xff]] ^ $t1[$s[$rk52 >> 16 & 0xff]] ^ $t2[$s[$rk52 >> 8 & 0xff]] ^ $t3[$s[$rk52 & 0xff]],
                    $t0[$s[$rk53 >> 24 & 0xff]] ^ $t1[$s[$rk53 >> 16 & 0xff]] ^ $t2[$s[$rk53 >> 8 & 0xff]] ^ $t3[$s[$rk53 & 0xff]],
                    $t0[$s[$rk54 >> 24 & 0xff]] ^ $t1[$s[$rk54 >> 16 & 0xff]] ^ $t2[$s[$rk54 >> 8 & 0xff]] ^ $t3[$s[$rk54 & 0xff]],
                    $t0[$s[$rk55 >> 24 & 0xff]] ^ $t1[$s[$rk55 >> 16 & 0xff]] ^ $t2[$s[$rk55 >> 8 & 0xff]] ^ $t3[$s[$rk55 & 0xff]],
                    $rk56,
                    $rk57,
                    $rk58,
                    $rk59
                ];

                break;
            default:
                throw new \LengthException('Invalid key length.');
        }

        return $pair;
    }
}
